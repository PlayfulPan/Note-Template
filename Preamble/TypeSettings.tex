% ======================================================== %
% -------------------- Main Font Setup ------------------- %
% ======================================================== %

\usepackage{iftex}

\ifLuaTeX
    \usepackage{mathtools}
    \usepackage[math-style=TeX, warnings-off={mathtools-colon, mathtools-overbracket}]{unicode-math}

    \setmainfont{Stix Two Text}
    \setmathfont{STIX Two Math}[CharacterVariant=04, script-features={CharacterVariant=04}, sscript-features={CharacterVariant=04}]
    \setmathfont{STIX Two Math}[range={scr,bfscr},StylisticSet=01]

\else
    \usepackage[utf8]{inputenc}
    \usepackage{stix2}
    \usepackage{mathtools}

    \DeclareSymbolFont{stix2-Syms}{TS1}{stix2}{m}{n}
    \DeclareMathSymbol{\OhmSymbol}{\mathord}{stix2-Syms}{87}
    \DeclareMathSymbol{\MicroSymbol}{\mathord}{stix2-Syms}{181}

    \providecommand{\symbf}[1]{\mathbf{#1}}
    \providecommand{\symsf}[1]{\mathsf{#1}}
    \providecommand{\symcal}[1]{\mathcal{#1}}
    \providecommand{\symbfcal}[1]{\mathbf{\mathcal{#1}}}
    \providecommand{\mathcolon}{:}
\fi

% ======================================================== %
% -------------------- Other Packages -------------------- %
% ======================================================== %

\usepackage[final]{microtype}
\usepackage[USenglish]{babel}

\usepackage[strict=true]{csquotes}
\usepackage[version=4]{mhchem}

% ======================================================== %
% ----------------------- Epigraph ----------------------- %
% ======================================================== %

\usepackage{epigraph}
\renewcommand{\epigraphflush}{center}

\makeatletter
\newlength\epitextskip
\pretocmd{\@epitext}{\em}{}{}
\apptocmd{\@epitext}{\em}{}{}
\patchcmd{\epigraph}{\@epitext{#1}\\}{\@epitext{#1}\\[\epitextskip]}{}{}
\makeatother

\setlength\epigraphrule{0pt}
\setlength\epitextskip{0ex}
\setlength\epigraphwidth{.6\textwidth}

% ======================================================== %
% ----------------------- SI Unitx ----------------------- %
% ======================================================== %

\usepackage{siunitx}
\sisetup{list-final-separator = {, and }}
\ifLuaTeX
    \DeclareSIUnit{\angstrom}{Å}
    \DeclareSIUnit{\degreeFahrenheit}{℉}
    \DeclareSIUnit{\ohm}{Ω}
    \DeclareSIPrefix{\micro}{µ}{-6}
    \DeclareSIUnit{\degreeCelsius}{℃}
    \DeclareSIUnit{\kelvin}{K}
\else
    \DeclareSIUnit{\angstrom}{\ensuremath{\Angstrom}}
    \DeclareSIUnit{\degreeFahrenheit}{\ensuremath{\text{\textdegree}}F}
    \DeclareSIUnit{\ohm}{\ensuremath{\OhmSymbol}}
    \DeclareSIPrefix{\micro}{\ensuremath{\MicroSymbol}}{-6}
\fi
